
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Libraries -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Custom stylesheets -->
    <link rel="stylesheet" href="resources/css/style.css">

    <style>
        #cards {
            display: flex;
            flex-direction: column;
            border-radius: 1rem;
            padding: 1rem;
            border: gray solid thin;
            width: fit-content;
            font-size: 1.25rem;

            & div {
                display: flex;
                gap: 0.5rem;
            }

            & div p {
                margin-bottom: 0;
            }
        }
    </style>
    <title>VocabCards</title>
</head>
<body>
    <main class="p-4">
        <label for="language" class="pr-2">Select language to practice: </label>
        <select id="language" name="language"></select>
        <br>
        <div id="cards"></div>
        <br>
        <a class="btn btn-primary" id="to-card-page" href="card.html">Add new card</a>
    </main>
</body>
<!-- Libraries -->
<script type="text/javascript" src="resources/lib/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<!-- Custom Scripts -->
<script src="src/ApiClient.js"></script>
<script src="src/languages.js"></script>

<script type="text/javascript">

    window.onload = async () => {

        // Append language to 'add card' redirect button
        const href = $('#to-card-page').attr('href');
        $('#to-card-page').attr('href', `${href}?${LANG_PARAM}=${SELECTED_LANGUAGE}`);

        loadLanguages($('#language'));
        loadCards(SELECTED_LANGUAGE, $('#cards'));
    }

    function loadLanguages($input) {
        API.Languages.getList().then(result => {
            if(result.success === true) {

                // Reload page with english as the selected language, if no valid language is selected.
                const allCodes = result.data.map(lang => lang.language_code);
                if(!allCodes.includes(SELECTED_LANGUAGE)) {
                    window.location.href = getLanguageRedirectUrl('EN');
                }
 
                // Add language options
                $input.append(getLanguageOptions(result.data));
                $input.val(SELECTED_LANGUAGE);
            }
            else alert("Could not load languages - " + (result.info || "error"));
        })

        $input.change(() => { 
            const lang = $input.val();
            window.location.href = getLanguageRedirectUrl(lang);
        });
    }

    async function loadCards(lang, $container) {

        const defResult = await API.Definitions.getForLanguage(lang, 'EN');
        if(defResult.success === false) return;
        const allDefinitions = defResult.data;

        const result = await API.Cards.getForLanguage(lang);
        if(result.success === false) return;
        result.data.forEach(card => {
            const $row = $('<div>');
            $row.append($('<p>').text(card.word));

            const def = allDefinitions.filter(d => d.card_id === card.id).map(d => d.word);
            $row.append($('<p>').text('(' + def.join(', ') + ')'));
        
            $container.append($row);
        })
    }

</script>
</html>